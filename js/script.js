function ItemInfo(a,b,c){function d(a){return!isNaN(parseFloat(a))&&isFinite(a)}this.dps=d(c)?parseFloat(c):0,this.type=b,this.generalType=b,$.inArray(b,ItemInfo.itemTypes.Weapon)>=0?this.generalType="Weapon":$.inArray(b,ItemInfo.itemTypes["Two-handed"])>=0?this.generalType="Two-handed":$.inArray(b,ItemInfo.itemTypes["Off-Hand"])>=0&&(this.generalType="Off-Hand"),this.statsString=a,this.stats=[],this.statsDict=[],this.starsRating=0,this.CalculateMaxStatsProgress=function(){this.statsString=this.statsString.replace(/, /g,",");var a=this.statsString.split(",").map($.trim);for(var b in a){var c=a[b];if(c.indexOf(" ")==-1)continue;var e=c.split(" "),f={name:e[1],value:e[0],max:0,progress:0};if(!d(f.value))continue;f.value=parseFloat(f.value);for(var g in ItemInfo.maxStats){var h=ItemInfo.maxStats[g];h[0]==this.generalType&&h[1].toLowerCase()==f.name.toLowerCase()&&(f.max=h[2])}f.max>0&&(f.progress=Math.round(Math.min(f.value/f.max,1)*100)),this.stats.push(f),this.statsDict[f.name.toLowerCase()]=f}},this.CalculateStarsRating=function(){var a=0,b=0,c=this.m("vit"),d=this.v("vit"),e=this.v("str"),f=this.v("dex"),g=this.v("int");$.inArray("str",Object.keys(this.statsDict))>=0&&e>=f&&e>=g?b=this.d(e+d,this.m("str")+c):$.inArray("dex",Object.keys(this.statsDict))>=0&&f>=e&&f>=g?b=this.d(f+d,this.m("dex")+c):$.inArray("int",Object.keys(this.statsDict))>=0&&g>=f&&g>=e&&(b=this.d(g+d,this.m("int")+c)),b=b*b*ItemInfo.starWeights.primary,a+=b;for(var h in ItemInfo.starWeights){var i=ItemInfo.starWeights[h];b=this.d(this.v(h),this.m(h)),b=Math.min(b,1),a+=b*b*i}this.dps>0&&(b=0,this.generalType=="Weapon"?b=this.dps/1400:this.generalType=="Two-handed"&&(b=this.dps/1800),b>1&&(b=1),b>.6&&(a+=b*b*ItemInfo.starWeights.dps)),this.starsRating=Math.round(Math.min(a,10))},this.d=function(a,b){return b==0?0:a>b?1:a/b},this.v=function(a){return $.inArray(a.toLowerCase(),Object.keys(this.statsDict))==-1?0:this.statsDict[a.toLowerCase()].value},this.m=function(a){a=a.toLowerCase();if($.inArray(a,Object.keys(this.statsDict))>=0)return this.statsDict[a].max;for(var b in ItemInfo.maxStats){var c=ItemInfo.maxStats[b];if(c[0]==this.generalType&&c[1].toLowerCase()==a)return c[2]}return 0},this.CalculateMaxStatsProgress(),this.CalculateStarsRating()}ItemInfo.Initialize=function(a){$.get("/data/json/itemtypes."+(new Date).getTime()+".json",function(b){ItemInfo.itemTypes=b,$.get("/data/json/maxstats."+(new Date).getTime()+".json",function(b){ItemInfo.maxStats=b,$.get("/data/json/star_weights."+(new Date).getTime()+".json",function(b){ItemInfo.starWeights=b,typeof a=="function"&&a()},"json")},"json")},"json")}(function(a){function c(){var b=d(this);return isNaN(b.datetime)||a(this).text(e(b.datetime)),this}function d(c){c=a(c);if(!c.data("timeago")){c.data("timeago",{datetime:b.datetime(c)});var d=a.trim(c.text());d.length>0&&(!b.isTime(c)||!c.attr("title"))&&c.attr("title",d)}return c.data("timeago")}function e(a){return b.inWords(f(a))}function f(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return b instanceof Date?e(b):typeof b=="string"?e(a.timeago.parse(b)):typeof b=="number"?e(new Date(b)):e(a.timeago.datetime(b))};var b=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function k(d,e){var f=a.isFunction(d)?d(e,b):d,g=c.numbers&&c.numbers[e]||e;return f.replace(/%d/i,g)}var c=this.settings.strings,d=c.prefixAgo,e=c.suffixAgo;this.settings.allowFuture&&b<0&&(d=c.prefixFromNow,e=c.suffixFromNow);var f=Math.abs(b)/1e3,g=f/60,h=g/60,i=h/24,j=i/365,l=f<45&&k(c.seconds,Math.round(f))||f<90&&k(c.minute,1)||g<45&&k(c.minutes,Math.round(g))||g<90&&k(c.hour,1)||h<24&&k(c.hours,Math.round(h))||h<42&&k(c.day,1)||i<30&&k(c.days,Math.round(i))||i<45&&k(c.month,1)||i<365&&k(c.months,Math.round(i/30))||j<1.5&&k(c.year,1)||k(c.years,Math.round(j)),m=c.wordSeparator===undefined?" ":c.wordSeparator;return a.trim([d,l,e].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(c)},datetime:function(c){var d=b.isTime(c)?a(c).attr("datetime"):a(c).attr("title");return b.parse(d)},isTime:function(b){return a(b).get(0).tagName.toLowerCase()==="time"}}),a.fn.timeago=function(){var a=this;a.each(c);var d=b.settings;return d.refreshMillis>0&&setInterval(function(){a.each(c)},d.refreshMillis),a},document.createElement("abbr"),document.createElement("time")}(jQuery));var scr=document.getElementsByTagName("script"),zoombox_path=scr[scr.length-1].getAttribute("src").replace("zoombox.js","");(function(a){function B(){o=="closed"&&(e=!1),o="load",N(),q.test(f)?(img=new Image,img.src=f,a("body").append('<div id="zoombox_loader"></div>'),a("#zoombox_loader").css("marginTop",Q()),i=window.setInterval(function(){H(img)},100)):(G(),E())}function C(){a("body").append(p),a(window).keydown(function(a){M(a.which)}),a(window).resize(function(){L()}),a("#zoombox .zoombox_mask").hide(),a("#zoombox").addClass(b.theme),a("#zoombox .zoombox_mask,.zoombox_close").click(function(){return F(),!1}),n==0?a("#zoombox .zoombox_next,#zoombox .zoombox_prev").remove():(a("#zoombox .zoombox_next").click(function(){J()}),a("#zoombox .zoombox_prev").click(function(){K()}))}function D(){var c=0,d=0,e=0;if(b.gallery){if(n===!1)return a("#zoombox .zoombox_gallery").remove(),!1;for(var f in n){var g=zoombox_path+"img/video.png",h=a('<img src="'+g+'" class="video gallery'+f*1+'"/>');q.test(n[f].attr("href"))&&(g=n[f].attr("href"),h=a('<img src="'+g+'" class="gallery'+f*1+'"/>')),h.data("id",f).appendTo("#zoombox .zoombox_gallery"),h.click(function(){I(a(this).data("id")),a("#zoombox .zoombox_gallery img").removeClass("current"),a(this).addClass("current")}),f==m&&h.addClass("current"),a("<img/>").data("img",h).attr("src",g).load(function(){c++;var b=a(this).data("img");b.width(Math.round(b.height()*this.width/this.height));if(c==a("#zoombox .zoombox_gallery img").length){var d=0;a("#zoombox .zoombox_gallery img").each(function(){d+=a(this).outerWidth(),a(this).data("left",d)});var f=a("<div>").css({position:"absolute",top:0,left:0,width:d});a("#zoombox .zoombox_gallery").wrapInner(f),e=a("#zoombox .zoombox_gallery").width(),a("#zoombox").trigger("change")}})}a("#zoombox .zoombox_gallery").show().animate({bottom:0},b.duration)}a("#zoombox").bind("change",function(c,d){if(a("#zoombox .zoombox_gallery div").width()<a("#zoombox .zoombox_gallery").width)return!0;var e=0,f=0;d!=null?(e=b.duration,f=d.width/2):f=a("#zoombox .zoombox_gallery").width()/2;var g=-a("#zoombox .zoombox_gallery img.current").data("left")+a("#zoombox .zoombox_gallery img.current").width()/2,h=g+f;h<f*2-a("#zoombox .zoombox_gallery div").width()&&(h=f*2-a("#zoombox .zoombox_gallery div").width()),h>0&&(h=0),a("#zoombox .zoombox_gallery div").animate({left:h},e)})}function E(){e==0?C():a("#zoombox .zoombox_title").empty(),a("#zoombox .close").hide(),a("#zoombox .zoombox_container").removeClass("multimedia").removeClass("img").addClass(l),d!=null&&d.attr("title")&&a("#zoombox .zoombox_title").append(d.attr("title")),a("#zoombox .zoombox_content").empty(),l=="img"&&e==0&&b.animation==1&&a("#zoombox .zoombox_content").append(k);if(d!=null&&d.find("img").length!=0&&e==0){var c=d.find("img");a("#zoombox .zoombox_container").css({width:c.width(),height:c.height(),top:c.offset().top,left:c.offset().left,opacity:0,marginTop:c.css("marginTop")})}else d!=null&&e==0?a("#zoombox .zoombox_container").css({width:d.width(),height:d.height(),top:d.offset().top,left:d.offset().left}):e==0&&a("#zoombox .zoombox_container").css({width:100,height:100,top:O()/2-50,left:P()/2-50});var f={width:g,height:h,left:(P()-g)/2,top:(O()-h)/2,marginTop:Q(),opacity:1};a("#zoombox").trigger("change",f),b.animation==1?(a("#zoombox .zoombox_title").hide(),a("#zoombox .zoombox_close").hide(),a("#zoombox .zoombox_container").animate(f,b.duration,function(){(l=="multimedia"||e==1)&&a("#zoombox .zoombox_content").append(k),(l=="image"||e==1)&&a("#zoombox .zoombox_content img").css("opacity",0).fadeTo(300,1),a("#zoombox .zoombox_title").fadeIn(300),a("#zoombox .zoombox_close").fadeIn(300),o="opened",e||D(),e=!0}),a("#zoombox .zoombox_mask").fadeTo(200,b.opacity)):(a("#zoombox .zoombox_content").append(k),a("#zoombox .zoombox_close").show(),a("#zoombox .zoombox_gallery").show(),a("#zoombox .zoombox_container").css(f),a("#zoombox .zoombox_mask").show(),a("#zoombox .zoombox_mask").css("opacity",b.opacity),e||D(),e=!0,o="opened")}function F(){o="closing",window.clearInterval(i),a(window).unbind("keydown"),a(window).unbind("resize"),l=="multimedia"&&a("#zoombox .zoombox_container").empty();var c={};if(d!=null&&d.find("img").length>0){var f=d.find("img");c={width:f.width(),height:f.height(),top:f.offset().top,left:f.offset().left,opacity:0,marginTop:f.css("marginTop")}}else d!=null?c={width:d.width(),height:d.height(),top:d.offset().top,left:d.offset().left,marginTop:0,opacity:0}:c={width:100,height:100,top:O()/2-50,left:P()/2-50,opacity:0};b.animation==1?(a("#zoombox .zoombox_mask").fadeOut(200),a("#zoombox .zoombox_gallery").animate({bottom:-a("#zoombox .zoombox_gallery").innerHeight()},b.duration),a("#zoombox .zoombox_container").animate(c,b.duration,function(){a("#zoombox").remove(),o="closed",e=!1})):(a("#zoombox").remove(),o="closed",e=!1)}function G(){b.overflow==0&&(g*1+50>P()&&(h=(P()-50)*h/g,g=P()-50),h*1+50>O()&&(g=(O()-50)*g/h,h=O()-50));var a=f;l="multimedia";if(q.test(a))l="img",k='<img src="'+f+'" width="100%" height="100%"/>';else if(r.test(a))g=300,h=40,k='<object type="application/x-shockwave-flash" data="'+MP3Player+"?son="+a+'" width="'+g+'" height="'+h+'">',k+='<param name="movie" value="'+MP3Player+"?son="+a+'" /></object>';else if(s.test(a)){var c=0;b.autoplay==1&&(c=1),k='<object type="application/x-shockwave-flash" data="'+zoombox_path+'FLVplayer.swf" width="'+g+'" height="'+h+'"><param name="allowFullScreen" value="true"><param name="scale" value="noscale"><param name="wmode" value="transparent"><param name="flashvars" value="flv='+a+"&autoplay="+c+'"><embed src="'+zoombox_path+'FLVplayer.swf" width="'+g+'" height="'+h+'" allowscriptaccess="always" allowfullscreen="true" flashvars="flv='+a+'" wmode="transparent" /></object>'}else if(t.test(a))k='<object width="'+g+'" height="'+h+'"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="'+a+'" /><embed src="'+a+'" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="'+g+'" height="'+h+'" wmode="transparent"></embed></object>';else if(u.test(a))k='<embed src="'+a+'" width="'+g+'" height="'+h+'" controller="true" cache="true" autoplay="true"/>';else if(v.test(a))k='<embed src="'+a+'" width="'+g+'" height="'+h+'" controller="true" cache="true" autoplay="true" wmode="transparent" />';else if(w.test(a)){var d=a.split("_");d=d[0].split("/"),d=d[d.length-1]+"?",b.autoplay==1&&(d+="autoPlay=1&"),k='<iframe frameborder="0" width="'+g+'" height="'+h+'" src="http://www.dailymotion.com/embed/video/'+d+'?wmode=transparent"></iframe>'}else if(x.test(a)){var d=a.split("/");d=d[3]+"?",b.autoplay==1&&(d+="autoplay=1&"),k='<iframe src="http://player.vimeo.com/video/'+d+'title=0&amp;byline=0&amp;portrait=0&amp;wmode=transparent" width="'+g+'" height="'+h+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}else if(y.test(a)){var d=a.split("watch?v=");d=d[1].split("&"),d=d[0]+"?",b.autoplay==1&&(d+="autoplay=1&"),k='<iframe width="'+g+'" height="'+h+'" src="http://www.youtube.com/embed/'+d+'wmode=Opaque" frameborder="0" allowfullscreen></iframe>'}else z.test(a)?(a=a.split(".html"),a=a[0],k='<object type="application/x-shockwave-flash" data="'+a+'" width="'+g+'" height="'+h+'"><param name="movie" value="'+a+'"><embed src="'+a+'" type="application/x-shockwave-flash" width="'+g+'" height="'+h+'"  wmode="transparent"></embed></object>'):k='<iframe src="'+a+'" width="'+g+'" height="'+h+'" border="0"></iframe>';return k}function H(b){b.complete&&(j=0,window.clearInterval(i),g=b.width,h=b.height,a("#zoombox_loader").remove(),G(),E()),a("#zoombox_loader").css({"background-position":"0px "+j+"px"}),j-=40,j<-440&&(j=0)}function I(b){return o!="opened"?!1:(m=b,d=n[m],f=d.attr("href"),a("#zoombox .zoombox_gallery img").length>0&&(a("#zoombox .zoombox_gallery img").removeClass("current"),a("#zoombox .zoombox_gallery img:eq("+b+")").addClass("current")),B(),!1)}function J(){j=m+1,j>n.length-1&&(j=0),I(j)}function K(){j=m-1,j<0&&(j=n.length-1),I(j)}function L(){a("#zoombox .zoombox_container").css({top:(O()-a("#zoombox .zoombox_container").outerHeight(!0))/2,left:(P()-a("#zoombox .zoombox_container").outerWidth(!0))/2})}function M(a){a==37&&K(),a==39&&J(),a==27&&F()}function N(){g=b.width,h=b.height;if(d!=null){var a=/w([0-9]+)/,c=a.exec(d.attr("class"));c!=null&&c[1]&&(g=c[1]);var e=/h([0-9]+)/,f=e.exec(d.attr("class"));f!=null&&f[1]&&(h=f[1])}return!1}function O(){return window.innerHeight?window.innerHeight:a(window).height()}function P(){return window.innerWidth?window.innerWidth:a(window).width()}function Q(){return scrOfY=0,typeof window.pageYOffset=="number"?scrOfY=window.pageYOffset:document.body&&document.body.scrollTop?scrOfY=document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop&&(scrOfY=document.documentElement.scrollTop),scrOfY}function R(){return scrOfX=0,typeof window.pageXOffset=="number"?scrOfX=window.pageXOffset:document.body&&document.body.scrollLeft?scrOfX=document.body.scrollLeft:document.documentElement&&document.documentElement.scrollLeft&&(scrOfX=document.documentElement.scrollLeft),scrOfX}var b={theme:"zoombox",opacity:.8,duration:800,animation:!0,width:600,height:400,gallery:!0,autoplay:!1,overflow:!1},c,d,e=!1,f,g,h,i,j=0,k,l="multimedia",m=!1,n=!1,o="closed",p='<div id="zoombox">             <div class="zoombox_mask"></div>            <div class="zoombox_container">                <div class="zoombox_content"></div>                <div class="zoombox_title"></div>                <div class="zoombox_next"></div>                <div class="zoombox_prev"></div>                <div class="zoombox_close"></div>            </div>            <div class="zoombox_gallery"></div>        </div>',q=/(\.jpg)|(\.jpeg)|(\.bmp)|(\.gif)|(\.png)/i,r=/(\.mp3)/i,s=/(\.flv)/i,t=/(\.swf)/i,u=/(\.mov)|(\.mp4)/i,v=/(\.wmv)|(\.avi)/i,w=/(http:\/\/www.dailymotion)|(http:\/\/dailymotion)/i,x=/(http:\/\/www.vimeo)|(http:\/\/vimeo)/i,y=/(youtube\.)/i,z=/(http:\/\/www\.koreus)|(http:\/\/koreus)/i,A=0;a.zoombox=function(a,b){},a.zoombox.options=b,a.zoombox.close=function(){F()},a.zoombox.open=function(c,e){d=null,f=c,b=a.extend({},a.zoombox.options,e),B()},a.zoombox.html=function(c,e){k=c,b=a.extend({},a.zoombox.options,e),g=b.width,h=b.height,d=null,E()},a.fn.zoombox=function(e){return c=new Array,this.each(function(){if(a.browser.msie&&a.browser.version<7&&!window.XMLHttpRequest)return!1;var g=this,h=/zgallery([0-9]+)/,i=h.exec(a(this).attr("class")),j=!1;if(i!=null){c[i[1]]||(c[i[1]]=new Array),c[i[1]].push(a(this));var k=c[i[1]].length-1;j=c[i[1]]}a(this).unbind("click").click(function(){return b=a.extend({},a.zoombox.options,e),o!="closed"?!1:(d=a(g),f=d.attr("href"),n=j,m=k,B(),!1)})})}})(jQuery),function(a){var b={};a.checkImage=function(a,c,d){var e=new Image,f=!1,g=!1;e.onload=function(){if(f)return;f=!0,c&&c.call&&c.call(e)},e.onerror=function(){if(g)return;b[a]=g=!0,d&&d.call&&d.call(e)},e.src=a,b[a]&&e.onerror.call(e),e.complete&&e.onload.call(e)}}(this),function(){$("a.zoombox").zoombox({width:400,height:320}),$(".timeago").timeago(),$("#thread .voteArrow, .thread .voteArrow").click(function(){if(loggedin!=1){alert("You need to be logged-in to vote.");return}var a=$(this),b=a.parent().find(".voteValue"),c=a.parent().find(".up"),d=a.parent().find(".down"),e=parseInt(a.parent().attr("data-id")),f=parseInt(b.text()),g=a.hasClass("active"),h=a.hasClass("up");h&&g?(a.removeClass("active"),b.text(f-1)):h?(a.addClass("active"),b.text(f+1),d.hasClass("active")&&(b.text(f+2),d.removeClass("active"))):!h&&g?(a.removeClass("active"),b.text(f+1)):h||(a.addClass("active"),b.text(f-1),c.hasClass("active")&&(b.text(f-2),c.removeClass("active"))),$.get("/ajax/threadvote/",{tid:e,v:h?1:-1})}),$(".delete").click(function(){if(!confirm("Are you sure you want to delete this?"))return!1}),$(".delete-album-item").click(function(){if(!confirm("Are you sure you want to delete this?"))return!1;$.get("/ajax/album/",{a:"deleteitem",albumId:$(this).attr("data-album-id"),itemId:$(this).attr("data-item-id")}),$(this).parents(".item").remove();var a=1;$(".item > span > strong").each(function(){$(this).text(a+"."),a++})}),$(".mark-album-item").click(function(){var a=$(this).parents(".item").find(".msg").text();a=prompt("item message:",a);if(!a&&a!="")return;$.get("/ajax/album/",{a:"markitem",albumId:$(this).attr("data-album-id"),itemId:$(this).attr("data-item-id"),msg:a});var b=$(this).parents(".item").find(".msg");b.find("span").text(a),b.removeClass("hidden"),a==""&&b.addClass("hidden")}),$(".tooltip").hover(function(a){$("body").append("<p id='preview'><img src='http://c15208371.r71.cf2.rackcdn.com/"+$(this).attr("data-item-id")+".png' alt='' /></p>"),$("#preview").css("top",a.pageY+"px").css("left",a.pageX+"px").fadeIn("fast"),$(".tooltip").mousemove()},function(){$("#preview").remove()}),$(".tooltip").mousemove(function(a){var b=$(window).scrollTop(),c=$(window).width(),d,e,f=15;c-f*2>=$("#preview").width()+a.pageX?d=a.pageX+f:d=c-$("#preview").width()-f,b+f*2>=a.pageY-$("#preview").height()?e=b+f:e=a.pageY-$("#preview").height()-f,$("#preview").css("top",e+"px").css("left",d+"px")}),$(".titleHolder input").focus()}();